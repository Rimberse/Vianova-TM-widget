<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:widget="http://www.netvibes.com/ns/">

<head>
    <title>Vianova T&M widget</title>
    <meta name="author" content="Kerim HUDAYBERDIYEV" />
    <meta name="description" content="Widget used to feed Vianova t&m data into City" />
    <meta name="keywords" content="Transportation, mobility, connected vehicles data" />
    <meta name="apiVersion" content="0.1" />
    <meta name="debugMode" content="true" />
    <meta name="strictMode" content="false" />

    <!-- FOR DEV PURPOSE ONLY -->
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <!-- End of FOR DEV PURPOSE ONLY -->

    <link rel="stylesheet" href="./lib/leaflet/leaflet.css" />
    <script src="./lib/leaflet/leaflet.js"></script>

    <!-- Leaflet CSS file -->
    <!-- <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" /> -->
    <!-- Leaflet JS file -->
    <!--<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>-->

    <!-- Application Standalone emulation files -->
    <link rel="stylesheet" type="text/css" href="http://uwa.netvibes.com/lib/c/UWA/assets/css/standalone.css" />
    <script type="text/javascript" src="http://uwa.netvibes.com/lib/c/UWA/js/UWA_Standalone_Alone.js"></script>

    <!-- Custom CSS or JS library -->
    <link rel="stylesheet" type="text/css" href="styles/style.css" />
    <!-- <script type="text/javascript" src="http://uwa.netvibes.com/lib/c/UWA/js/UWA_Standalone_Alone.js"></script> -->

    <script>
        // const div = document.createElement('div');
        // div.id = "map";

        // let h = 'https://api.vianova.dev';
        // let path = '/token'
        // const address = h.concat(path);

        // // Setting up the headers
        // const headers = new Headers({
        //     'Content-Type': 'application/x-www-form-urlencoded'
        // });

        // const usr = prompt("Enter username:");
        // const pass = prompt("Enter password:");

        // // Setting up the body
        // const body = new URLSearchParams({
        //     username: usr,
        //     password: pass
        // });

        // (async () => {
        //     const rawResponse = await fetch(address, {
        //         method: 'POST',
        //         body
        //     });

        //     let result = await rawResponse.json();
        //     console.info(result);
        //     console.info(result['access_token']);
        // })();


        // (async () => {
        //     let host = 'https://vianova-tm.herokuapp.com/api';
        //     let path = '/token'
        //     const address = host.concat(path);

        //     let rawResponse = await fetch(address, { method: 'GET' });
        //     let data = await rawResponse.json();
        //     console.log(data['access_token']);

        //     path = '/zoneID?token=';

        //         // const headers = new Headers({ 'Authorization': 'Bearer ' + data['access_token'] });

        //         // const requestOptions = {
        //         //     method: 'GET'
        //         //     // headers,
        //         //     // redirect: 'follow'
        //         // };

        //         // fetch(host.concat(path) + data['access_token'])
        //         //     .then(response => response.json())
        //         //     .then(result => console.log(result.zone_id))
        //         //     .catch(error => console.log('error', error));

        //         rawResponse = await fetch(host.concat(path) + data['access_token'], { method: 'GET' })
        //         data = await rawResponse.json();
        //         console.info("INDEX: " + data['zone_id']);
        // })();

        var host = 'https://tourmaline-souffle-ae39d0.netlify.app',       // URL of server
            project = '';            // folder referencing to your project resources

        // AMD loader setting. For complete documentation, refer to https://requirejs.org/docs/whyamd.html
        require.config({
            paths: {
                'Widget': host + project,
                'Modules': host + project + '/modules',
                'DS': host + '/assets/DS',
                'Lib': host + '/lib/leaflet'
            }
        });

        require(
            [
                "Widget/js/Main"
            ],
            function (
                Main
            ) {
                // global variables (widget, UWA, document)

                // Function to call when widget is loaded
                widget.addEvent("onLoad", Main.onLoad);

                // Function to call when widget is being resized
                widget.addEvent("onResize", Main.onResize);

                // Function to call when widget view changed
                widget.addEvent("onViewChange", Main.onViewChange);

                // Function to call when a preference item is changed
                widget.addEvent("onEdit", Main.onEdit);

                // Function to call when refresh button is clicked
                widget.addEvent("onRefresh", Main.onRefresh);

                // Function to call when prefence edit is finalized
                widget.addEvent("endEdit", Main.endEdit);
            }
        );
    </script>
</head>

<body>
    <div id="map"></div>
</body>

</html>